!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Poster presentation Niels Burghoorn</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1" />
		<link rel="stylesheet" href="css/nft-style.css" />
	</head>

	<body>
		<!-- <a href="https://raw.githubusercontent.com/artoolkitx/artoolkit5/master/doc/Marker%20images/pinball.jpg" class="ui marker" target="_blank">
			ðŸ–¼ Marker Image
		</a> -->

		<script src="js/third_party/three.js/three.min.js"></script>
		<script src="js/ARnftThreejs.js"></script>
		<script src="../dist/ARnft.js"></script>

		<script>
			//let nftName = 'poster_banner'
			let nftName_1 = 'poster';
			let model_1 = 'anim_19' + '.gltf';

			let width = 320;
      		let height = 640;

			ARnft.ARnft.init(width,height,[["assets/nft-markers/" + nftName_1]],[[nftName_1]],"config.json",true)
				.then((nft) => {
					let mat = new THREE.MeshLambertMaterial({
						color: 0xff0000,
					});
					let boxGeom = new THREE.BoxGeometry(1, 1, 1);
					let cube = new THREE.Mesh(boxGeom, mat);
					cube.position.z = 90;
					cube.scale.set(1, 1, 180);
					
					let mat2 = new THREE.MeshLambertMaterial({
						color: 0xff0000,
					});
					let boxGeom2 = new THREE.BoxGeometry(1, 1, 1);
					let cube2 = new THREE.Mesh(boxGeom, mat);
					cube2.position.z = 200;
					cube2.scale.set(10, 10, 10);

					let testEntities = ARnft.ARnft.getEntities();
                	console.log("entities from getEntities static method: ", testEntities);

					document.addEventListener("containerEvent", function (ev) {
						let canvas = document.getElementById("canvas");
						let fov = (0.8 * 180) / Math.PI;
						let ratio = width / height;
						let config = {
							renderer: {
								alpha: true,
								antialias: true,
								context: null,
								precision: "mediump",
								premultipliedAlpha: true,
								stencil: true,
								depth: true,
								logarithmicDepthBuffer: true,
							},
							camera: {
								fov: fov,
								ratio: ratio,
								near: 0.01,
								far: 1000,
							},
						};

						let sceneThreejs = new ARnftThreejs.SceneRendererTJS(config, canvas, nft.uuid, true);
						sceneThreejs.initRenderer();

						
						const renderer = sceneThreejs.getRenderer();
						const scene = sceneThreejs.getScene();
						renderer.outputEncoding = THREE.sRGBEncoding;
						renderer.physicallyCorrectLights = true;
						let directionalLight = new THREE.DirectionalLight("#fff", 10);
						directionalLight.position.set(0.5, 0, 0.866);7
						scene.add(directionalLight);
						
						let nftAddTJS = new ARnftThreejs.NFTaddTJS(nft.uuid);
						nftAddTJS.oef = true;
						
						nftAddTJS.add(cube, nftName_1, false);
            			// nftAddTJS.addModel('assets/3d-models/'+ model_1, nftName_1, 25, false);
						
						//animation stuff
						let mixers = [];
						let clock = new THREE.Clock();
						
						function modelAnimation(gltf) {
							var model = gltf.scene.children[0];
							var animation = gltf.animations[0];

							var mixer = new THREE.AnimationMixer(model);
							mixers.push(mixer);
							var action = mixer.clipAction(animation);
							action.play();
						}

						function updateAnimations() {
							if (mixers.length > 0) {
								for (var i = 0; i < mixers.length; i++) {
									mixers[i].update(clock.getDelta());
								}
							}
						}
						
						nftAddTJS.addModelWithCallback('assets/3d-models/'+ model_1, nftName_1, modelAnimation, false);
						
						const tick = () => {
							sceneThreejs.draw();
							window.requestAnimationFrame(tick);
							updateAnimations();
						};
						tick();
					});
				})
				.catch((error) => {
					console.log(error);
				});
    </script>
	</body>
</html>