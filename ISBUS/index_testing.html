!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Poster presentation Niels Burghoorn</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=1" />
		<link rel="stylesheet" href="css/nft-style.css" />
	</head>

	<body>
		<!-- <video loop autoplay muted webkit-playsinline playsinline crossOrigin="anonymous" id="arvideo">
			<source src="assets/develop.mp4" type='video/mp4'>
		</video> -->

		<!-- <video loop autoplay muted webkit-playsinline playsinline crossOrigin="anonymous" id="arvideo">
			<source src="https://avo-content-dev.s3.amazonaws.com/videos/bg_1588085276090.mp4" type='video/mp4'>
		</video> -->
		<a href="https://raw.githubusercontent.com/artoolkitx/artoolkit5/master/doc/Marker%20images/pinball.jpg"
			class="ui marker" target="_blank">
			ðŸ–¼ Marker Image
		</a>

		<script src="js/third_party/three.js/three.min.js"></script>
		<script src="js/ARnftThreejs.js"></script>
		<script src="dist/ARnft.js"></script>
		
		<script>
			function toggle(button) {
				if (button.value == "OFF") {
				  button.value = "ON";
				} else {
				  button.value = "OFF";
				}
			}

			let nftName_1 = 'ISBUS_poster';
			let model_1 = 'anim' + '.glb';
			fetch("assets/3d-models/" + model_1, {cache : 'no-'})

			//fetch("assets/nft-markers/poster.fset", {cache : 'no-cache'})
			//fetch("assets/nft-markers/poster.fset3", {cache : 'no-cache'})
			//fetch("assets/nft-markers/poster.iset", {cache : 'no-cache'})

			let width = 320;
      		let height = 640;

			ARnft.ARnft.init(width,height,[["assets/nft-markers/" + nftName_1]],[[nftName_1]],"config.json",true)
				.then((nft) => {
					let mat = new THREE.MeshLambertMaterial({
						color: 0xff0000,
					});
					let boxGeom = new THREE.BoxGeometry(1, 1, 1);
					let cube = new THREE.Mesh(boxGeom, mat);
					cube.position.z = 90;
					cube.scale.set(1, 1, 180);

					//let testEntities = ARnft.ARnft.getEntities();
                	//console.log("entities from getEntities static method: ", testEntities);

					document.addEventListener("containerEvent", function (ev) {
						let canvas = document.getElementById("canvas");
						let fov = (0.8 * 180) / Math.PI;
						let ratio = width / height;
						let config = {
							renderer: {
								alpha: true,
								antialias: true,
								context: null,
								precision: "mediump",
								premultipliedAlpha: true,
								stencil: true,
								depth: true,
								logarithmicDepthBuffer: true,
							},
							camera: {
								fov: 23,//fov,
								ratio: ratio,
								near: 0.01,
								far: 1000,
							},
						};

						let sceneThreejs = new ARnftThreejs.SceneRendererTJS(config, canvas, nft.uuid, true);
						sceneThreejs.initRenderer();

						
						const renderer = sceneThreejs.getRenderer();
						const scene = sceneThreejs.getScene();
						renderer.outputEncoding = THREE.sRGBEncoding;
						renderer.physicallyCorrectLights = true;
						let directionalLight = new THREE.DirectionalLight("#fff", 10);
						directionalLight.position.set(0.5, 0, 0.866);7
						scene.add(directionalLight);
						
						let nftAddTJS = new ARnftThreejs.NFTaddTJS(nft.uuid);
						nftAddTJS.oef = true;

						//const delay = ms => new Promise(res => setTimeout(res, ms));
						//const yourFunction = async () => {
						//	await delay(5000);
						//	console.log("Waited 5s");
						//};
						
						//load indicator
						nftAddTJS.add(cube, nftName_1, false);
						
						//video load
						//let imgConfig = {w: 1, h: 1, ws: 1, hs: 1};
                    	//let videoObj = nftAddTJS.addVideo('arvideo', nftName_1, 180, imgConfig, false);
						//videoObj.position.set(20,20,20);

						//animation load
						let mixers = [];
						let clock = new THREE.Clock();
						
						function modelAnimation(gltf) {
							var model = gltf.scene.children[0];
							//model.position.x = 135;
							//model.position.y = 160;
							//model.position.z = -60;

							var animation = gltf.animations[0];

							var mixer = new THREE.AnimationMixer(model);
							mixers.push(mixer);
							var action = mixer.clipAction(animation);
							action.play();
						}

						function updateAnimations() {
							if (mixers.length > 0) {
								for (var i = 0; i < mixers.length; i++) {
									mixers[i].update(clock.getDelta());
								}
							}
						}
						
						nftAddTJS.addModelWithCallback('assets/3d-models/'+ model_1, nftName_1, modelAnimation, false);
						
						const tick = () => {
							sceneThreejs.draw();
							window.requestAnimationFrame(tick);
							updateAnimations();
						};
						tick();
					});
				})
				.catch((error) => {
					console.log(error);
				});
    </script>

	<label class="switch">
		<input type="checkbox" checked>
		<span class="slider round"></span>
	</label>

	<div id="main_content">Slider 1</div>
	<div id="secondary_content">Slider 2</div>
	
	</body>
</html>